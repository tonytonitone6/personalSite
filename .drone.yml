clone:
  git:
    image: plugins/git
    depath: 50
    tags: true


pipeline:
    backend:
      image: node:11.13.0
      secrets: [ ssh_key ]
      commands:
        - touch maomao.txt
        - echo $SSH_KEY

    front:
      image: node:11.13.0
      when:
        branch: [ master, dev ]
      commands:
        - yarn install
        - yarn run prod

    test:
      when:
        branch: [ master, dev ]
      commands:
        - yarn run test
    
    scp:
      image: appleboy/drone-scp
      host:
        - 206.189.147.149
      port: 22
      username: stan
      secrets: [ ssh_key ]
      target: /drone/${DRONE_REPO}
      source: 
        - "dist"
        - "node_modules"
        - "*.js"
      when:
        branch: [ master, dev]

    # ssh:
    #   image: appleboy/drone-ssh
    #   host:
    #     - 206.189.147.149
    #   port: 22
    #   username: stan
    #   secrets: [ ssh_key ]
    #   command_timeout: 120
    #   script:
    #     - rm -rf ${DRONE_REPO} && mkdir -p ${DRONE_REPO}
    #     - cp -r drone/${DRONE_REPO}/* /var/www/test2
    #     - cd /var/www/test && ls



